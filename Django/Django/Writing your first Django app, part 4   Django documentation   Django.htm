<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- saved from url=(0055)https://docs.djangoproject.com/en/1.6/intro/tutorial04/ -->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    
    <meta http-equiv="Content-Language" content="en-us">
    <title>Writing your first Django app, part 4 | Django documentation | Django</title>
    <meta name="ROBOTS" content="ALL">
    <meta http-equiv="imagetoolbar" content="no">
    <meta name="MSSmartTagsPreventParsing" content="true">
    <meta name="Copyright" content="Django Software Foundation">
    <meta name="keywords" content="Python, Django, framework, open-source">
    <meta name="description" content="Django is a high-level Python Web framework that encourages rapid development and clean, pragmatic design.">
    
    <link href="./Writing your first Django app, part 4   Django documentation   Django_files/base.383e0bb3119d.css" rel="stylesheet" type="text/css" media="screen">
    
    <link href="./Writing your first Django app, part 4   Django documentation   Django_files/print.ac134bbb8dfc.css" rel="stylesheet" type="text/css" media="print">
    
  
  <link rel="stylesheet" href="./Writing your first Django app, part 4   Django documentation   Django_files/docs.0047ef2d621d.css" type="text/css">
  <link rel="stylesheet" href="./Writing your first Django app, part 4   Django documentation   Django_files/pygments.0d57d48be058.css" type="text/css">

  </head>
  <body id="documentation" class="default" style="">
  <div id="container">
    <div id="header">
      <h1 id="logo"><a href="https://www.djangoproject.com/"><img src="./Writing your first Django app, part 4   Django documentation   Django_files/hdr_logo.b19c5e60269d.gif" alt="Django"></a></h1>
      <ul id="nav-global">
        <li id="nav-homepage"><a href="https://www.djangoproject.com/">Home</a></li>
        <li id="nav-download"><a href="https://www.djangoproject.com/download/">Download</a></li>
        <li id="nav-documentation"><a href="https://docs.djangoproject.com/en/1.6/">Documentation</a></li>
        <li id="nav-weblog"><a href="https://www.djangoproject.com/weblog/">Weblog</a></li>
        <li id="nav-community"><a href="https://www.djangoproject.com/community/">Community</a></li>
        <li id="nav-code"><a href="https://code.djangoproject.com/">Code</a></li>
      </ul>
    </div>
    <!-- END Header -->
    <div id="billboard">
  <h2><a href="https://docs.djangoproject.com/en/1.6/">Django documentation</a></h2>
</div>
    <div id="columnwrap">
      
		<div id="content-main">
		


  
  
  <ul id="doc-versions">
      
        
          <li class="other">
          
            <a href="https://docs.djangoproject.com/en/1.0/intro/tutorial04/">1.0</a>
          
          </li>
        
      
        
          <li class="other">
          
            <a href="https://docs.djangoproject.com/en/1.1/intro/tutorial04/">1.1</a>
          
          </li>
        
      
        
          <li class="other">
          
            <a href="https://docs.djangoproject.com/en/1.2/intro/tutorial04/">1.2</a>
          
          </li>
        
      
        
          <li class="other">
          
            <a href="https://docs.djangoproject.com/en/1.3/intro/tutorial04/">1.3</a>
          
          </li>
        
      
        
          <li class="other">
          
            <a href="https://docs.djangoproject.com/en/1.4/intro/tutorial04/">1.4</a>
          
          </li>
        
      
        
          <li class="other">
          
            <a href="https://docs.djangoproject.com/en/1.5/intro/tutorial04/">1.5</a>
          
          </li>
        
      
        
      
        
          <li class="other">
          
            <a href="https://docs.djangoproject.com/en/dev/intro/tutorial04/">dev</a>
          
          </li>
        
      
      <li class="current" title="This document describes Django 1.6. Click on the links on the left to see other versions.">
        <span>Documentation version:
          <strong>1.6
          </strong>
        </span>
      </li>
  </ul>
  <div class="section" id="s-writing-your-first-django-app-part-4">
<span id="writing-your-first-django-app-part-4"></span><h1>Writing your first Django app, part 4<a class="headerlink" href="https://docs.djangoproject.com/en/1.6/intro/tutorial04/#writing-your-first-django-app-part-4" title="Permalink to this headline">¶</a></h1>
<p>This tutorial begins where <a class="reference internal" href="https://docs.djangoproject.com/en/1.6/intro/tutorial03/"><em>Tutorial 3</em></a> left off. We’re
continuing the Web-poll application and will focus on simple form processing and
cutting down our code.</p>
<div class="section" id="s-write-a-simple-form">
<span id="write-a-simple-form"></span><h2>Write a simple form<a class="headerlink" href="https://docs.djangoproject.com/en/1.6/intro/tutorial04/#write-a-simple-form" title="Permalink to this headline">¶</a></h2>
<p>Let’s update our poll detail template (“polls/detail.html”) from the last
tutorial, so that the template contains an HTML <tt class="docutils literal"><span class="pre">&lt;form&gt;</span></tt> element:</p>
<div class="highlight-html+django"><div class="highlight"><pre><span class="nt">&lt;h1&gt;</span><span class="cp">{{</span> <span class="nv">poll.question</span> <span class="cp">}}</span><span class="nt">&lt;/h1&gt;</span>

<span class="cp">{%</span> <span class="k">if</span> <span class="nv">error_message</span> <span class="cp">%}</span><span class="nt">&lt;p&gt;&lt;strong&gt;</span><span class="cp">{{</span> <span class="nv">error_message</span> <span class="cp">}}</span><span class="nt">&lt;/strong&gt;&lt;/p&gt;</span><span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>

<span class="nt">&lt;form</span> <span class="na">action=</span><span class="s">"</span><span class="cp">{%</span> <span class="k">url</span> <span class="s1">'polls:vote'</span> <span class="nv">poll.id</span> <span class="cp">%}</span><span class="s">"</span> <span class="na">method=</span><span class="s">"post"</span><span class="nt">&gt;</span>
<span class="cp">{%</span> <span class="k">csrf_token</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">for</span> <span class="nv">choice</span> <span class="k">in</span> <span class="nv">poll.choice_set.all</span> <span class="cp">%}</span>
    <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"radio"</span> <span class="na">name=</span><span class="s">"choice"</span> <span class="na">id=</span><span class="s">"choice</span><span class="cp">{{</span> <span class="nb">forloop</span><span class="nv">.counter</span> <span class="cp">}}</span><span class="s">"</span> <span class="na">value=</span><span class="s">"</span><span class="cp">{{</span> <span class="nv">choice.id</span> <span class="cp">}}</span><span class="s">"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">"choice</span><span class="cp">{{</span> <span class="nb">forloop</span><span class="nv">.counter</span> <span class="cp">}}</span><span class="s">"</span><span class="nt">&gt;</span><span class="cp">{{</span> <span class="nv">choice.choice_text</span> <span class="cp">}}</span><span class="nt">&lt;/label&gt;&lt;br</span> <span class="nt">/&gt;</span>
<span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span>
<span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"submit"</span> <span class="na">value=</span><span class="s">"Vote"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/form&gt;</span>
</pre></div>
</div>
<p>A quick rundown:</p>
<ul class="simple">
<li>The above template displays a radio button for each poll choice. The
<tt class="docutils literal"><span class="pre">value</span></tt> of each radio button is the associated poll choice’s ID. The
<tt class="docutils literal"><span class="pre">name</span></tt> of each radio button is <tt class="docutils literal"><span class="pre">"choice"</span></tt>. That means, when somebody
selects one of the radio buttons and submits the form, it’ll send the
POST data <tt class="docutils literal"><span class="pre">choice=3</span></tt>. This is the basic concept of HTML forms.</li>
<li>We set the form’s <tt class="docutils literal"><span class="pre">action</span></tt> to <tt class="docutils literal"><span class="pre">{%</span> <span class="pre">url</span> <span class="pre">'polls:vote'</span> <span class="pre">poll.id</span> <span class="pre">%}</span></tt>, and we
set <tt class="docutils literal"><span class="pre">method="post"</span></tt>. Using <tt class="docutils literal"><span class="pre">method="post"</span></tt> (as opposed to
<tt class="docutils literal"><span class="pre">method="get"</span></tt>) is very important, because the act of submitting this
form will alter data server-side. Whenever you create a form that alters
data server-side, use <tt class="docutils literal"><span class="pre">method="post"</span></tt>. This tip isn’t specific to
Django; it’s just good Web development practice.</li>
<li><tt class="docutils literal"><span class="pre">forloop.counter</span></tt> indicates how many times the <a class="reference internal" href="https://docs.djangoproject.com/en/1.6/ref/templates/builtins/#std:templatetag-for"><tt class="xref std std-ttag docutils literal"><span class="pre">for</span></tt></a> tag has gone
through its loop</li>
<li>Since we’re creating a POST form (which can have the effect of modifying
data), we need to worry about Cross Site Request Forgeries.
Thankfully, you don’t have to worry too hard, because Django comes with
a very easy-to-use system for protecting against it. In short, all POST
forms that are targeted at internal URLs should use the
<a class="reference internal" href="https://docs.djangoproject.com/en/1.6/ref/templates/builtins/#std:templatetag-csrf_token"><tt class="xref std std-ttag docutils literal"><span class="pre">{%</span> <span class="pre">csrf_token</span> <span class="pre">%}</span></tt></a> template tag.</li>
</ul>
<p>Now, let’s create a Django view that handles the submitted data and does
something with it. Remember, in <a class="reference internal" href="https://docs.djangoproject.com/en/1.6/intro/tutorial03/"><em>Tutorial 3</em></a>, we
created a URLconf for the polls application that includes this line:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">url</span><span class="p">(</span><span class="s">r'^(?P&lt;poll_id&gt;\d+)/vote/$'</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">vote</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">'vote'</span><span class="p">),</span>
</pre></div>
</div>
<p>We also created a dummy implementation of the <tt class="docutils literal"><span class="pre">vote()</span></tt> function. Let’s
create a real version. Add the following to <tt class="docutils literal"><span class="pre">polls/views.py</span></tt>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">get_object_or_404</span><span class="p">,</span> <span class="n">render</span>
<span class="kn">from</span> <span class="nn">django.http</span> <span class="kn">import</span> <span class="n">HttpResponseRedirect</span><span class="p">,</span> <span class="n">HttpResponse</span>
<span class="kn">from</span> <span class="nn">django.core.urlresolvers</span> <span class="kn">import</span> <span class="n">reverse</span>
<span class="kn">from</span> <span class="nn">polls.models</span> <span class="kn">import</span> <span class="n">Choice</span><span class="p">,</span> <span class="n">Poll</span>
<span class="c"># ...</span>
<span class="k">def</span> <span class="nf">vote</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">poll_id</span><span class="p">):</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">Poll</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="n">poll_id</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">selected_choice</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">choice_set</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">[</span><span class="s">'choice'</span><span class="p">])</span>
    <span class="k">except</span> <span class="p">(</span><span class="ne">KeyError</span><span class="p">,</span> <span class="n">Choice</span><span class="o">.</span><span class="n">DoesNotExist</span><span class="p">):</span>
        <span class="c"># Redisplay the poll voting form.</span>
        <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s">'polls/detail.html'</span><span class="p">,</span> <span class="p">{</span>
            <span class="s">'poll'</span><span class="p">:</span> <span class="n">p</span><span class="p">,</span>
            <span class="s">'error_message'</span><span class="p">:</span> <span class="s">"You didn't select a choice."</span><span class="p">,</span>
        <span class="p">})</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">selected_choice</span><span class="o">.</span><span class="n">votes</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">selected_choice</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="c"># Always return an HttpResponseRedirect after successfully dealing</span>
        <span class="c"># with POST data. This prevents data from being posted twice if a</span>
        <span class="c"># user hits the Back button.</span>
        <span class="k">return</span> <span class="n">HttpResponseRedirect</span><span class="p">(</span><span class="n">reverse</span><span class="p">(</span><span class="s">'polls:results'</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">id</span><span class="p">,)))</span>
</pre></div>
</div>
<p>This code includes a few things we haven’t covered yet in this tutorial:</p>
<ul>
<li><p class="first"><a class="reference internal" href="https://docs.djangoproject.com/en/1.6/ref/request-response/#django.http.HttpRequest.POST" title="django.http.HttpRequest.POST"><tt class="xref py py-attr docutils literal"><span class="pre">request.POST</span></tt></a> is a dictionary-like
object that lets you access submitted data by key name. In this case,
<tt class="docutils literal"><span class="pre">request.POST['choice']</span></tt> returns the ID of the selected choice, as a
string. <a class="reference internal" href="https://docs.djangoproject.com/en/1.6/ref/request-response/#django.http.HttpRequest.POST" title="django.http.HttpRequest.POST"><tt class="xref py py-attr docutils literal"><span class="pre">request.POST</span></tt></a> values are
always strings.</p>
<p>Note that Django also provides <a class="reference internal" href="https://docs.djangoproject.com/en/1.6/ref/request-response/#django.http.HttpRequest.GET" title="django.http.HttpRequest.GET"><tt class="xref py py-attr docutils literal"><span class="pre">request.GET</span></tt></a> for accessing GET data in the same way –
but we’re explicitly using <a class="reference internal" href="https://docs.djangoproject.com/en/1.6/ref/request-response/#django.http.HttpRequest.POST" title="django.http.HttpRequest.POST"><tt class="xref py py-attr docutils literal"><span class="pre">request.POST</span></tt></a> in our code, to ensure that data is only
altered via a POST call.</p>
</li>
<li><p class="first"><tt class="docutils literal"><span class="pre">request.POST['choice']</span></tt> will raise <a class="reference external" href="http://docs.python.org/2.7/library/exceptions.html#exceptions.KeyError" title="(in Python v2.7)"><tt class="xref py py-exc docutils literal"><span class="pre">KeyError</span></tt></a> if
<tt class="docutils literal"><span class="pre">choice</span></tt> wasn’t provided in POST data. The above code checks for
<a class="reference external" href="http://docs.python.org/2.7/library/exceptions.html#exceptions.KeyError" title="(in Python v2.7)"><tt class="xref py py-exc docutils literal"><span class="pre">KeyError</span></tt></a> and redisplays the poll form with an error
message if <tt class="docutils literal"><span class="pre">choice</span></tt> isn’t given.</p>
</li>
<li><p class="first">After incrementing the choice count, the code returns an
<a class="reference internal" href="https://docs.djangoproject.com/en/1.6/ref/request-response/#django.http.HttpResponseRedirect" title="django.http.HttpResponseRedirect"><tt class="xref py py-class docutils literal"><span class="pre">HttpResponseRedirect</span></tt></a> rather than a normal
<a class="reference internal" href="https://docs.djangoproject.com/en/1.6/ref/request-response/#django.http.HttpResponse" title="django.http.HttpResponse"><tt class="xref py py-class docutils literal"><span class="pre">HttpResponse</span></tt></a>.
<a class="reference internal" href="https://docs.djangoproject.com/en/1.6/ref/request-response/#django.http.HttpResponseRedirect" title="django.http.HttpResponseRedirect"><tt class="xref py py-class docutils literal"><span class="pre">HttpResponseRedirect</span></tt></a> takes a single argument: the
URL to which the user will be redirected (see the following point for how
we construct the URL in this case).</p>
<p>As the Python comment above points out, you should always return an
<a class="reference internal" href="https://docs.djangoproject.com/en/1.6/ref/request-response/#django.http.HttpResponseRedirect" title="django.http.HttpResponseRedirect"><tt class="xref py py-class docutils literal"><span class="pre">HttpResponseRedirect</span></tt></a> after successfully dealing with
POST data. This tip isn’t specific to Django; it’s just good Web
development practice.</p>
</li>
<li><p class="first">We are using the <a class="reference internal" href="https://docs.djangoproject.com/en/1.6/ref/urlresolvers/#django.core.urlresolvers.reverse" title="django.core.urlresolvers.reverse"><tt class="xref py py-func docutils literal"><span class="pre">reverse()</span></tt></a> function in the
<a class="reference internal" href="https://docs.djangoproject.com/en/1.6/ref/request-response/#django.http.HttpResponseRedirect" title="django.http.HttpResponseRedirect"><tt class="xref py py-class docutils literal"><span class="pre">HttpResponseRedirect</span></tt></a> constructor in this example.
This function helps avoid having to hardcode a URL in the view function.
It is given the name of the view that we want to pass control to and the
variable portion of the URL pattern that points to that view. In this
case, using the URLconf we set up in Tutorial 3, this
<a class="reference internal" href="https://docs.djangoproject.com/en/1.6/ref/urlresolvers/#django.core.urlresolvers.reverse" title="django.core.urlresolvers.reverse"><tt class="xref py py-func docutils literal"><span class="pre">reverse()</span></tt></a> call will return a string like</p>
<div class="highlight-python"><div class="highlight"><pre><span class="s">'/polls/3/results/'</span>
</pre></div>
</div>
<p>... where the <tt class="docutils literal"><span class="pre">3</span></tt> is the value of <tt class="docutils literal"><span class="pre">p.id</span></tt>. This redirected URL will
then call the <tt class="docutils literal"><span class="pre">'results'</span></tt> view to display the final page.</p>
</li>
</ul>
<p>As mentioned in Tutorial 3, <tt class="docutils literal"><span class="pre">request</span></tt> is a <a class="reference internal" href="https://docs.djangoproject.com/en/1.6/ref/request-response/#django.http.HttpRequest" title="django.http.HttpRequest"><tt class="xref py py-class docutils literal"><span class="pre">HttpRequest</span></tt></a>
object. For more on <a class="reference internal" href="https://docs.djangoproject.com/en/1.6/ref/request-response/#django.http.HttpRequest" title="django.http.HttpRequest"><tt class="xref py py-class docutils literal"><span class="pre">HttpRequest</span></tt></a> objects, see the
<a class="reference internal" href="https://docs.djangoproject.com/en/1.6/ref/request-response/"><em>request and response documentation</em></a>.</p>
<p>After somebody votes in a poll, the <tt class="docutils literal"><span class="pre">vote()</span></tt> view redirects to the results
page for the poll. Let’s write that view:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">get_object_or_404</span><span class="p">,</span> <span class="n">render</span>

<span class="k">def</span> <span class="nf">results</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">poll_id</span><span class="p">):</span>
    <span class="n">poll</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">Poll</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="n">poll_id</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s">'polls/results.html'</span><span class="p">,</span> <span class="p">{</span><span class="s">'poll'</span><span class="p">:</span> <span class="n">poll</span><span class="p">})</span>
</pre></div>
</div>
<p>This is almost exactly the same as the <tt class="docutils literal"><span class="pre">detail()</span></tt> view from <a class="reference internal" href="https://docs.djangoproject.com/en/1.6/intro/tutorial03/"><em>Tutorial 3</em></a>. The only difference is the template name. We’ll fix this
redundancy later.</p>
<p>Now, create a <tt class="docutils literal"><span class="pre">polls/results.html</span></tt> template:</p>
<div class="highlight-html+django"><div class="highlight"><pre><span class="nt">&lt;h1&gt;</span><span class="cp">{{</span> <span class="nv">poll.question</span> <span class="cp">}}</span><span class="nt">&lt;/h1&gt;</span>

<span class="nt">&lt;ul&gt;</span>
<span class="cp">{%</span> <span class="k">for</span> <span class="nv">choice</span> <span class="k">in</span> <span class="nv">poll.choice_set.all</span> <span class="cp">%}</span>
    <span class="nt">&lt;li&gt;</span><span class="cp">{{</span> <span class="nv">choice.choice_text</span> <span class="cp">}}</span> -- <span class="cp">{{</span> <span class="nv">choice.votes</span> <span class="cp">}}</span> vote<span class="cp">{{</span> <span class="nv">choice.votes</span><span class="o">|</span><span class="nf">pluralize</span> <span class="cp">}}</span><span class="nt">&lt;/li&gt;</span>
<span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span>
<span class="nt">&lt;/ul&gt;</span>

<span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"</span><span class="cp">{%</span> <span class="k">url</span> <span class="s1">'polls:detail'</span> <span class="nv">poll.id</span> <span class="cp">%}</span><span class="s">"</span><span class="nt">&gt;</span>Vote again?<span class="nt">&lt;/a&gt;</span>
</pre></div>
</div>
<p>Now, go to <tt class="docutils literal"><span class="pre">/polls/1/</span></tt> in your browser and vote in the poll. You should see a
results page that gets updated each time you vote. If you submit the form
without having chosen a choice, you should see the error message.</p>
</div>
<div class="section" id="s-use-generic-views-less-code-is-better">
<span id="use-generic-views-less-code-is-better"></span><h2>Use generic views: Less code is better<a class="headerlink" href="https://docs.djangoproject.com/en/1.6/intro/tutorial04/#use-generic-views-less-code-is-better" title="Permalink to this headline">¶</a></h2>
<p>The <tt class="docutils literal"><span class="pre">detail()</span></tt> (from <a class="reference internal" href="https://docs.djangoproject.com/en/1.6/intro/tutorial03/"><em>Tutorial 3</em></a>) and <tt class="docutils literal"><span class="pre">results()</span></tt>
views are stupidly simple – and, as mentioned above, redundant. The <tt class="docutils literal"><span class="pre">index()</span></tt>
view (also from Tutorial 3), which displays a list of polls, is similar.</p>
<p>These views represent a common case of basic Web development: getting data from
the database according to a parameter passed in the URL, loading a template and
returning the rendered template. Because this is so common, Django provides a
shortcut, called the “generic views” system.</p>
<p>Generic views abstract common patterns to the point where you don’t even need
to write Python code to write an app.</p>
<p>Let’s convert our poll app to use the generic views system, so we can delete a
bunch of our own code. We’ll just have to take a few steps to make the
conversion. We will:</p>
<ol class="arabic simple">
<li>Convert the URLconf.</li>
<li>Delete some of the old, unneeded views.</li>
<li>Introduce new views based on Django’s generic views.</li>
</ol>
<p>Read on for details.</p>
<div class="admonition-why-the-code-shuffle admonition">
<p class="first admonition-title">Why the code-shuffle?</p>
<p>Generally, when writing a Django app, you’ll evaluate whether generic views
are a good fit for your problem, and you’ll use them from the beginning,
rather than refactoring your code halfway through. But this tutorial
intentionally has focused on writing the views “the hard way” until now, to
focus on core concepts.</p>
<p class="last">You should know basic math before you start using a calculator.</p>
</div>
<div class="section" id="s-amend-urlconf">
<span id="amend-urlconf"></span><h3>Amend URLconf<a class="headerlink" href="https://docs.djangoproject.com/en/1.6/intro/tutorial04/#amend-urlconf" title="Permalink to this headline">¶</a></h3>
<p>First, open the <tt class="docutils literal"><span class="pre">polls/urls.py</span></tt> URLconf and change it like so:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">django.conf.urls</span> <span class="kn">import</span> <span class="n">patterns</span><span class="p">,</span> <span class="n">url</span>

<span class="kn">from</span> <span class="nn">polls</span> <span class="kn">import</span> <span class="n">views</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="n">patterns</span><span class="p">(</span><span class="s">''</span><span class="p">,</span>
    <span class="n">url</span><span class="p">(</span><span class="s">r'^$'</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">IndexView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s">'index'</span><span class="p">),</span>
    <span class="n">url</span><span class="p">(</span><span class="s">r'^(?P&lt;pk&gt;\d+)/$'</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">DetailView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s">'detail'</span><span class="p">),</span>
    <span class="n">url</span><span class="p">(</span><span class="s">r'^(?P&lt;pk&gt;\d+)/results/$'</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">ResultsView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s">'results'</span><span class="p">),</span>
    <span class="n">url</span><span class="p">(</span><span class="s">r'^(?P&lt;poll_id&gt;\d+)/vote/$'</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">vote</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">'vote'</span><span class="p">),</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="s-amend-views">
<span id="amend-views"></span><h3>Amend views<a class="headerlink" href="https://docs.djangoproject.com/en/1.6/intro/tutorial04/#amend-views" title="Permalink to this headline">¶</a></h3>
<p>Next, we’re going to remove our old <tt class="docutils literal"><span class="pre">index</span></tt>, <tt class="docutils literal"><span class="pre">detail</span></tt>, and <tt class="docutils literal"><span class="pre">results</span></tt>
views and use Django’s generic views instead. To do so, open the
<tt class="docutils literal"><span class="pre">polls/views.py</span></tt> file and change it like so:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">get_object_or_404</span><span class="p">,</span> <span class="n">render</span>
<span class="kn">from</span> <span class="nn">django.http</span> <span class="kn">import</span> <span class="n">HttpResponseRedirect</span>
<span class="kn">from</span> <span class="nn">django.core.urlresolvers</span> <span class="kn">import</span> <span class="n">reverse</span>
<span class="kn">from</span> <span class="nn">django.views</span> <span class="kn">import</span> <span class="n">generic</span>

<span class="kn">from</span> <span class="nn">polls.models</span> <span class="kn">import</span> <span class="n">Choice</span><span class="p">,</span> <span class="n">Poll</span>

<span class="k">class</span> <span class="nc">IndexView</span><span class="p">(</span><span class="n">generic</span><span class="o">.</span><span class="n">ListView</span><span class="p">):</span>
    <span class="n">template_name</span> <span class="o">=</span> <span class="s">'polls/index.html'</span>
    <span class="n">context_object_name</span> <span class="o">=</span> <span class="s">'latest_poll_list'</span>

    <span class="k">def</span> <span class="nf">get_queryset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">"""Return the last five published polls."""</span>
        <span class="k">return</span> <span class="n">Poll</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s">'-pub_date'</span><span class="p">)[:</span><span class="mi">5</span><span class="p">]</span>


<span class="k">class</span> <span class="nc">DetailView</span><span class="p">(</span><span class="n">generic</span><span class="o">.</span><span class="n">DetailView</span><span class="p">):</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">Poll</span>
    <span class="n">template_name</span> <span class="o">=</span> <span class="s">'polls/detail.html'</span>


<span class="k">class</span> <span class="nc">ResultsView</span><span class="p">(</span><span class="n">generic</span><span class="o">.</span><span class="n">DetailView</span><span class="p">):</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">Poll</span>
    <span class="n">template_name</span> <span class="o">=</span> <span class="s">'polls/results.html'</span>

<span class="k">def</span> <span class="nf">vote</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">poll_id</span><span class="p">):</span>
    <span class="o">....</span>
</pre></div>
</div>
<p>We’re using two generic views here:
<a class="reference internal" href="https://docs.djangoproject.com/en/1.6/ref/class-based-views/generic-display/#django.views.generic.list.ListView" title="django.views.generic.list.ListView"><tt class="xref py py-class docutils literal"><span class="pre">ListView</span></tt></a> and
<a class="reference internal" href="https://docs.djangoproject.com/en/1.6/ref/class-based-views/generic-display/#django.views.generic.detail.DetailView" title="django.views.generic.detail.DetailView"><tt class="xref py py-class docutils literal"><span class="pre">DetailView</span></tt></a>. Respectively, those
two views abstract the concepts of “display a list of objects” and
“display a detail page for a particular type of object.”</p>
<ul class="simple">
<li>Each generic view needs to know what model it will be acting
upon. This is provided using the <tt class="docutils literal"><span class="pre">model</span></tt> attribute.</li>
<li>The <a class="reference internal" href="https://docs.djangoproject.com/en/1.6/ref/class-based-views/generic-display/#django.views.generic.detail.DetailView" title="django.views.generic.detail.DetailView"><tt class="xref py py-class docutils literal"><span class="pre">DetailView</span></tt></a> generic view
expects the primary key value captured from the URL to be called
<tt class="docutils literal"><span class="pre">"pk"</span></tt>, so we’ve changed <tt class="docutils literal"><span class="pre">poll_id</span></tt> to <tt class="docutils literal"><span class="pre">pk</span></tt> for the generic
views.</li>
</ul>
<p>By default, the <a class="reference internal" href="https://docs.djangoproject.com/en/1.6/ref/class-based-views/generic-display/#django.views.generic.detail.DetailView" title="django.views.generic.detail.DetailView"><tt class="xref py py-class docutils literal"><span class="pre">DetailView</span></tt></a> generic
view uses a template called <tt class="docutils literal"><span class="pre">&lt;app</span> <span class="pre">name&gt;/&lt;model</span> <span class="pre">name&gt;_detail.html</span></tt>.
In our case, it’ll use the template <tt class="docutils literal"><span class="pre">"polls/poll_detail.html"</span></tt>. The
<tt class="docutils literal"><span class="pre">template_name</span></tt> attribute is used to tell Django to use a specific
template name instead of the autogenerated default template name. We
also specify the <tt class="docutils literal"><span class="pre">template_name</span></tt> for the <tt class="docutils literal"><span class="pre">results</span></tt> list view –
this ensures that the results view and the detail view have a
different appearance when rendered, even though they’re both a
<a class="reference internal" href="https://docs.djangoproject.com/en/1.6/ref/class-based-views/generic-display/#django.views.generic.detail.DetailView" title="django.views.generic.detail.DetailView"><tt class="xref py py-class docutils literal"><span class="pre">DetailView</span></tt></a> behind the scenes.</p>
<p>Similarly, the <a class="reference internal" href="https://docs.djangoproject.com/en/1.6/ref/class-based-views/generic-display/#django.views.generic.list.ListView" title="django.views.generic.list.ListView"><tt class="xref py py-class docutils literal"><span class="pre">ListView</span></tt></a> generic
view uses a default template called <tt class="docutils literal"><span class="pre">&lt;app</span> <span class="pre">name&gt;/&lt;model</span>
<span class="pre">name&gt;_list.html</span></tt>; we use <tt class="docutils literal"><span class="pre">template_name</span></tt> to tell
<a class="reference internal" href="https://docs.djangoproject.com/en/1.6/ref/class-based-views/generic-display/#django.views.generic.list.ListView" title="django.views.generic.list.ListView"><tt class="xref py py-class docutils literal"><span class="pre">ListView</span></tt></a> to use our existing
<tt class="docutils literal"><span class="pre">"polls/index.html"</span></tt> template.</p>
<p>In previous parts of the tutorial, the templates have been provided
with a context that contains the <tt class="docutils literal"><span class="pre">poll</span></tt> and <tt class="docutils literal"><span class="pre">latest_poll_list</span></tt>
context variables. For <tt class="docutils literal"><span class="pre">DetailView</span></tt> the <tt class="docutils literal"><span class="pre">poll</span></tt> variable is provided
automatically – since we’re using a Django model (<tt class="docutils literal"><span class="pre">Poll</span></tt>), Django
is able to determine an appropriate name for the context variable.
However, for ListView, the automatically generated context variable is
<tt class="docutils literal"><span class="pre">poll_list</span></tt>. To override this we provide the <tt class="docutils literal"><span class="pre">context_object_name</span></tt>
attribute, specifying that we want to use <tt class="docutils literal"><span class="pre">latest_poll_list</span></tt> instead.
As an alternative approach, you could change your templates to match
the new default context variables – but it’s a lot easier to just
tell Django to use the variable you want.</p>
<p>Run the server, and use your new polling app based on generic views.</p>
<p>For full details on generic views, see the <a class="reference internal" href="https://docs.djangoproject.com/en/1.6/topics/class-based-views/"><em>generic views documentation</em></a>.</p>
<p>When you’re comfortable with forms and generic views, read <a class="reference internal" href="https://docs.djangoproject.com/en/1.6/intro/tutorial05/"><em>part 5 of this
tutorial</em></a> to learn about testing our polls app.</p>
</div>
</div>
</div>


<div class="browse-horizontal">
  
    <div class="left"><a href="https://docs.djangoproject.com/en/1.6/intro/tutorial03/">« Writing your first Django app, part 3</a></div>
  
  
    <div class="right"><a href="https://docs.djangoproject.com/en/1.6/intro/tutorial05/">Writing your first Django app, part 5 »</a></div>
  
</div>
<div id="content-secondary">
  <h2 id="comments">Questions/Feedback</h2>
  <p>Having trouble? We'd like to help!</p>
  <ul>
    <li>
      
      Try the <a href="https://docs.djangoproject.com/en/1.6/faq/">FAQ</a> — it's got answers to many common questions.
    </li>
    <li>
      Search for information in the <a href="http://groups.google.com/group/django-users/">archives of the
      django-users mailing list</a>, or <a href="http://groups.google.com/group/django-users/">post a question</a>.
    </li>
    <li>
      Ask a question in the <a href="irc://irc.freenode.net/">#django IRC
      channel</a>, or search the <a href="http://django-irc-logs.com/">IRC
      logs</a> to see if it has been asked before.
    </li>
    <li>
      If you notice errors with this documentation, please <a href="https://code.djangoproject.com/newticket?component=Documentation">
      open a ticket</a> and let us know! Please only use the ticket tracker for
      criticisms and improvements on the docs. For tech support, use the
      resources above.
    </li>
  </ul>
</div>

		</div>
		<!-- END #content-main -->
		<div id="content-related" class="sidebar">
		
  
    <h2>Search</h2>
    
    

<form action="https://docs.djangoproject.com/search/" id="sidebar_search" class="search">
  <div>
    <p>
      <input id="id_sidebar_search_q" name="q" type="search">
    </p>
    <p>
      <label for="id_sidebar_search_release">Version:</label>
      <select id="id_sidebar_search_release" name="release">
<option value="2">Django 1.0</option>
<option value="3">Django 1.1</option>
<option value="4">Django 1.2</option>
<option value="5">Django 1.3</option>
<option value="6">Django 1.4</option>
<option value="7">Django 1.5</option>
<option value="9" selected="selected">Django 1.6</option>
<option value="1">Development trunk</option>
</select>
    </p>
    <p>
      <input type="submit" class="submit" value="Search">
    </p>
  </div>
</form>

  

  
    <h2>Contents</h2>
    
      <ul>
<li><a class="reference internal" href="https://docs.djangoproject.com/en/1.6/intro/tutorial04/#">Writing your first Django app, part 4</a><ul>
<li><a class="reference internal" href="https://docs.djangoproject.com/en/1.6/intro/tutorial04/#write-a-simple-form">Write a simple form</a></li>
<li><a class="reference internal" href="https://docs.djangoproject.com/en/1.6/intro/tutorial04/#use-generic-views-less-code-is-better">Use generic views: Less code is better</a><ul>
<li><a class="reference internal" href="https://docs.djangoproject.com/en/1.6/intro/tutorial04/#amend-urlconf">Amend URLconf</a></li>
<li><a class="reference internal" href="https://docs.djangoproject.com/en/1.6/intro/tutorial04/#amend-views">Amend views</a></li>
</ul>
</li>
</ul>
</li>
</ul>

    
  
  
    <h2>Browse</h2>
    <ul>
      
        
          <li>Prev: <a href="https://docs.djangoproject.com/en/1.6/intro/tutorial03/">Writing your first Django app, part 3</a></li>
        
        
          <li>Next: <a href="https://docs.djangoproject.com/en/1.6/intro/tutorial05/">Writing your first Django app, part 5</a></li>
        
        <li><a href="https://docs.djangoproject.com/en/1.6/contents/">Table of contents</a></li>
        
          <li><a href="https://docs.djangoproject.com/en/1.6/genindex/">General Index</a></li>
        
          <li><a href="https://docs.djangoproject.com/en/1.6/py-modindex/">Python Module Index</a></li>
        
      
    </ul>
  

  
    <h2>You are here:</h2>
    <ul>
      
        <li>
          <a href="https://docs.djangoproject.com/en/1.6/">Django 1.6 documentation</a>
          
            <ul><li><a href="https://docs.djangoproject.com/en/1.6/intro/">Getting started</a>
          
          <ul><li>Writing your first Django app, part 4</li></ul>
          </li></ul>
        </li>
      
    </ul>

    
      <h2>Download:</h2>
      <p>
        Offline (Django 1.6):
        <a href="https://docs.djangoproject.com/m/docs/django-docs-1.6-en.zip">HTML</a> |
        <a href="http://media.readthedocs.org/pdf/django/1.6.x/django.pdf">PDF</a> |
        <a href="http://media.readthedocs.org/epub/django/1.6.x/django.epub">ePub</a>
      <br>
      <span class="quiet">
        Provided by <a href="http://readthedocs.org/">Read the Docs</a>.
      </span>
      </p>
    
  

		</div>
		<!-- END #content-related -->

    </div>
    <!-- END #content -->
    <div id="footer">
      <p>© 2005-2013
        <a href="https://www.djangoproject.com/foundation/"> Django Software
        Foundation</a> unless otherwise noted. Django is a
        <a href="https://www.djangoproject.com/trademarks/">registered
        trademark</a> of the Django Software Foundation.
        <a href="http://mediatemple.net/">Linux Web hosting</a> graciously
        provided by Media Temple.
      </p>
    </div>
    <!-- END #footer -->
  </div>
  <!-- END #container -->
  
  <script src="./Writing your first Django app, part 4   Django documentation   Django_files/jquery.min.js"></script>
  <script>
  // Propagate the fragment identifier to the links in the version switcher
  $(document).ready(function () {
    // Propagate the fragment identifier to the links in the version switcher
    $('#doc-versions a').click(function () {
      var hrefWithoutFragment = this.href.split('#')[0];
      this.href = hrefWithoutFragment + window.location.hash;
      // do nothing and let the event bubble up
    });
  });
  </script>


  

</body></html>